<!-- Action Status Change Modal -->
<div class="modal fade" id="actionStatusModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="POST" action="" id="actionStatusForm">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <div class="modal-header">
                    <h5 class="modal-title">Change Action Status</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="action_id" id="modalActionId">
                    <p>Action: <strong id="modalActionName"></strong></p>
                    <p>Current Status: <span class="badge bg-secondary" id="modalCurrentStatus"></span></p>
                    
                    <div class="mb-3">
                        <label for="modalTargetStatus" class="form-label">New Status <span class="text-danger">*</span></label>
                        <select class="form-select" id="modalTargetStatus" name="status" required>
                            <option value="">-- Select Status --</option>
                            <option value="Not Started">Not Started</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Complete">Complete</option>
                            <option value="Failed">Failed</option>
                            <option value="Skipped">Skipped</option>
                            <option value="Blocked">Blocked</option>
                        </select>
                    </div>
                    
                    <div class="mb-3" id="commentSection">
                        <label for="statusComment" class="form-label">Comment <span class="text-danger" id="commentRequired">*</span></label>
                        <textarea class="form-control" id="statusComment" name="comment" rows="3"></textarea>
                        <input type="hidden" name="edited_comment" id="editedComment">
                        <small class="text-muted" id="commentHelp">You can edit this comment before submitting.</small>
                    </div>
                    
                    <!-- Part Demand Management for Complete -->
                    <div class="mb-3" id="completePartDemandsSection" style="display: none;">
                        <div class="card border-info">
                            <div class="card-header bg-info bg-opacity-10 py-2">
                                <small class="fw-bold text-info">
                                    <i class="bi bi-box-seam"></i> Part Demand Management
                                </small>
                            </div>
                            <div class="card-body py-2">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="issuePartDemands" name="issue_part_demands" value="true" checked>
                                    <label class="form-check-label" for="issuePartDemands">
                                        Automatically issue all non-issued part demands
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Part Demand Management for Failed/Skipped -->
                    <div class="mb-3" id="partDemandsSection" style="display: none;">
                        <div class="card border-warning">
                            <div class="card-header bg-warning bg-opacity-10 py-2">
                                <small class="fw-bold text-warning">
                                    <i class="bi bi-box-seam"></i> Part Demand Management
                                </small>
                            </div>
                            <div class="card-body py-2">
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio" name="part_demand_action" id="partDemandLeaveAsIs" value="leave_as_is" checked>
                                    <label class="form-check-label" for="partDemandLeaveAsIs">
                                        Leave part demands as is
                                    </label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio" name="part_demand_action" id="duplicatePartDemands" value="duplicate">
                                    <label class="form-check-label" for="duplicatePartDemands">
                                        Duplicate all part demands (parts may have been consumed during failure)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="part_demand_action" id="cancelPartDemands" value="cancel">
                                    <label class="form-check-label" for="cancelPartDemands">
                                        Cancel all non-issued part demands (task failed before start or was skipped)
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3" id="billableHoursSection">
                        <label for="statusBillableHours" class="form-label">Billable Hours</label>
                        <input type="number" step="any" min="0" class="form-control" id="statusBillableHours" name="billable_hours">
                    </div>
                    
                    <div class="mb-3" id="completionNotesSection">
                        <label for="statusCompletionNotes" class="form-label">Completion Notes</label>
                        <textarea class="form-control" id="statusCompletionNotes" name="completion_notes" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Status</button>
                </div>
            </form>
        </div>
    </div>
</div>
