<!-- Close Limitation Modal -->
{% if active_limitations %}
{% set limitation = active_limitations[0] %}
<div class="modal fade" id="closeLimitationModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="POST" action="{{ url_for('maintenance.close_limitation', limitation_id=limitation.id) }}">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <div class="modal-header">
                    <h5 class="modal-title">Close Asset Capability Limitation</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Status: <strong>{{ limitation.status }}</strong></p>
                    {% if asset %}
                    <p class="text-muted small">Closing this limitation will update the asset's capability status based on any remaining active limitations.</p>
                    {% endif %}
                    
                    {% if limitation.limitation_description %}
                    <div class="mb-3">
                        <p class="mb-0"><strong>Limitation:</strong></p>
                        <p class="text-muted">{{ limitation.limitation_description }}</p>
                    </div>
                    {% endif %}
                    
                    {% if limitation.temporary_modifications %}
                    <div class="mb-3">
                        <p class="mb-0"><strong>Temporary Modifications:</strong></p>
                        <p class="text-muted">{{ limitation.temporary_modifications }}</p>
                    </div>
                    {% endif %}
                    
                    <div class="mb-3">
                        <label for="limitationStartTime" class="form-label">Start Time <span class="text-danger">*</span></label>
                        <input type="datetime-local" class="form-control" id="limitationStartTime" name="start_time" 
                               value="{{ limitation.start_time.strftime('%Y-%m-%dT%H:%M') if limitation.start_time else '' }}" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="limitationEndTime" class="form-label">End Time <span class="text-danger">*</span></label>
                        <input type="datetime-local" class="form-control" id="limitationEndTime" name="end_time" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="closeLimitationComment" class="form-label">Comment</label>
                        <textarea class="form-control" id="closeLimitationComment" name="comment" rows="3" placeholder="Optional comment about closing this limitation"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success">Close Limitation</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endif %}
