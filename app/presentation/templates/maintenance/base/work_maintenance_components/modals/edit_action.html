<!-- Edit Action Modal -->
<div class="modal fade" id="editActionModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form method="POST" action="" id="editActionForm">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <div class="modal-header">
                    <h5 class="modal-title">Edit Action</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                    <input type="hidden" name="action_id" id="editActionId">
                    
                    <!-- Read-only metadata fields -->
                    <div class="card mb-3 bg-light">
                        <div class="card-header py-2">
                            <small class="fw-bold">Metadata (Read-only)</small>
                        </div>
                        <div class="card-body py-2">
                            <div class="row g-2">
                                <div class="col-md-6">
                                    <label class="form-label small">Action ID</label>
                                    <input type="text" class="form-control form-control-sm" id="editActionIdDisplay" disabled>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label small">Maintenance Action Set ID</label>
                                    <input type="text" class="form-control form-control-sm" id="editMaintenanceActionSetId" name="maintenance_action_set_id" disabled>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label small">Template Action Item ID</label>
                                    <input type="text" class="form-control form-control-sm" id="editTemplateActionItemId" 
                                           data-bs-toggle="tooltip" data-bs-placement="top" 
                                           title="Warning: Changing template action item ID may break template relationships" disabled>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label small">Assigned By ID</label>
                                    <input type="text" class="form-control form-control-sm" id="editAssignedById" disabled>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label small">Created At</label>
                                    <input type="text" class="form-control form-control-sm" id="editCreatedAt" disabled>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label small">Updated At</label>
                                    <input type="text" class="form-control form-control-sm" id="editUpdatedAt" disabled>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Editable fields from VirtualActionItem and Action -->
                    <div class="mb-3">
                        <label for="editActionNameField" class="form-label">Action Name <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="editActionNameField" name="action_name" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="editDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="editDescription" name="description" rows="3"></textarea>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="editStatus" class="form-label">Status</label>
                            <select class="form-select" id="editStatus" name="status">
                                <option value="Not Started">Not Started</option>
                                <option value="In Progress">In Progress</option>
                                <option value="Complete">Complete</option>
                                <option value="Failed">Failed</option>
                                <option value="Skipped">Skipped</option>
                                <option value="Blocked">Blocked</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="editSequenceOrder" class="form-label">Sequence Order</label>
                            <input type="number" min="1" class="form-control" id="editSequenceOrder" name="sequence_order">
                            <small class="text-muted">Changing this will reorder actions in the set</small>
                        </div>
                    </div>
                    
                    <!-- Reset to In Progress Option (for terminal states) -->
                    <div class="mb-3" id="resetToInProgressSection" style="display: none;">
                        <div class="alert alert-info">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="resetToInProgress" name="reset_to_in_progress" value="true">
                                <label class="form-check-label" for="resetToInProgress">
                                    <strong>Reset action to "In Progress"</strong> (for retry scenarios)
                                </label>
                            </div>
                            <small class="text-muted">This will change the action status from a terminal state back to "In Progress" to allow retry.</small>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="editScheduledStartTime" class="form-label">Scheduled Start Time</label>
                            <input type="datetime-local" class="form-control" id="editScheduledStartTime" name="scheduled_start_time">
                        </div>
                        <div class="col-md-6">
                            <label for="editStartTime" class="form-label">Start Time</label>
                            <input type="datetime-local" class="form-control" id="editStartTime" name="start_time">
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="editEndTime" class="form-label">End Time</label>
                            <input type="datetime-local" class="form-control" id="editEndTime" name="end_time">
                        </div>
                        <div class="col-md-6">
                            <label for="editAssignedUserId" class="form-label">Assigned User</label>
                            <select class="form-select" id="editAssignedUserId" name="assigned_user_id">
                                <option value="">Unassigned</option>
                                {% for user in users %}
                                <option value="{{ user.id }}">{{ user.username }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="editEstimatedDuration" class="form-label">Estimated Duration (hours)</label>
                            <input type="number" min="0" class="form-control" id="editEstimatedDuration" name="estimated_duration">
                        </div>
                        <div class="col-md-6">
                            <label for="editExpectedBillableHours" class="form-label">Expected Billable Hours</label>
                            <input type="number" min="0" class="form-control" id="editExpectedBillableHours" name="expected_billable_hours">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="editBillableHours" class="form-label">Billable Hours</label>
                        <input type="number" step="any" min="0" class="form-control" id="editBillableHours" name="billable_hours">
                    </div>
                    
                    <div class="mb-3">
                        <label for="editCompletionNotes" class="form-label">Completion Notes</label>
                        <textarea class="form-control" id="editCompletionNotes" name="completion_notes" rows="3"></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label for="editSafetyNotes" class="form-label">Safety Notes</label>
                        <textarea class="form-control" id="editSafetyNotes" name="safety_notes" rows="3"></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label for="editNotes" class="form-label">Notes</label>
                        <textarea class="form-control" id="editNotes" name="notes" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>
