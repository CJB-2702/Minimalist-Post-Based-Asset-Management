<div class="card mb-3 info-card {% if dispatch.status == 'Completed' %}success{% elif dispatch.status == 'Active' or dispatch.status == 'Dispatched' %}primary{% elif dispatch.status == 'Planned' %}info{% elif dispatch.status == 'Cancelled' %}danger{% else %}secondary{% endif %}">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="bi bi-calendar-event"></i> Dispatch Information
            <a href="{{ url_for('dispatching.dispatches_detail', item_id=dispatch.id) }}" class="text-decoration-none float-end">
                <small>View Details <i class="bi bi-arrow-right"></i></small>
            </a>
        </h5>
    </div>
    <div class="card-body">
        <dl class="row mb-0">
            <dt class="col-sm-4">Dispatch ID</dt>
            <dd class="col-sm-8">
                <a href="{{ url_for('dispatching.dispatches_detail', item_id=dispatch.id) }}" class="text-decoration-none">
                    #{{ dispatch.id }}
                </a>
            </dd>
            
            <dt class="col-sm-4">Status</dt>
            <dd class="col-sm-8">
                <span class="badge 
                    {% if dispatch.status == 'Completed' %}bg-success
                    {% elif dispatch.status == 'Active' or dispatch.status == 'Dispatched' %}bg-primary
                    {% elif dispatch.status == 'Planned' %}bg-info
                    {% elif dispatch.status == 'Cancelled' %}bg-danger
                    {% else %}bg-secondary{% endif %}">
                    {{ dispatch.status }}
                </span>
                {% if dispatch.conflicts_resolved %}
                <span class="badge bg-success ms-2"><i class="bi bi-check-circle"></i> Conflicts Resolved</span>
                {% endif %}
            </dd>
            
            <dt class="col-sm-4">Scheduled Times</dt>
            <dd class="col-sm-8">
                {% if dispatch.scheduled_start %}
                    <strong>Start:</strong> {{ dispatch.scheduled_start.strftime('%Y-%m-%d %H:%M') if dispatch.scheduled_start else 'N/A' }}<br>
                {% endif %}
                {% if dispatch.scheduled_end %}
                    <strong>End:</strong> {{ dispatch.scheduled_end.strftime('%Y-%m-%d %H:%M') if dispatch.scheduled_end else 'N/A' }}
                {% endif %}
            </dd>
            
            {% if dispatch.actual_start %}
            <dt class="col-sm-4">Actual Times</dt>
            <dd class="col-sm-8">
                <strong>Start:</strong> {{ dispatch.actual_start.strftime('%Y-%m-%d %H:%M') if dispatch.actual_start else 'N/A' }}<br>
                {% if dispatch.actual_end %}
                    <strong>End:</strong> {{ dispatch.actual_end.strftime('%Y-%m-%d %H:%M') if dispatch.actual_end else 'Ongoing' }}
                {% else %}
                    <strong>End:</strong> <span class="text-muted">Ongoing</span>
                {% endif %}
            </dd>
            {% endif %}
            
            {% if dispatch.meter_start is not none %}
            <dt class="col-sm-4">Meter Readings</dt>
            <dd class="col-sm-8">
                <strong>Start:</strong> {{ dispatch.meter_start }}<br>
                {% if dispatch.meter_end is not none %}
                    <strong>End:</strong> {{ dispatch.meter_end }}
                {% else %}
                    <strong>End:</strong> <span class="text-muted">Ongoing</span>
                {% endif %}
            </dd>
            {% endif %}
            
            {% if dispatch.asset_dispatched_id %}
            <dt class="col-sm-4">Asset Dispatched</dt>
            <dd class="col-sm-8">
                {% if dispatch.asset_dispatched %}
                    <a href="{{ url_for('core_assets.detail', asset_id=dispatch.asset_dispatched.id) }}" class="text-decoration-none">
                        {{ dispatch.asset_dispatched.name }}
                    </a>
                {% else %}
                    Asset ID: {{ dispatch.asset_dispatched_id }}
                {% endif %}
            </dd>
            {% endif %}
            
            {% if dispatch.assigned_by %}
            <dt class="col-sm-4">Assigned By</dt>
            <dd class="col-sm-8">{{ dispatch.assigned_by.username if dispatch.assigned_by else 'N/A' }}</dd>
            {% endif %}
            
            {% if dispatch.assigned_person %}
            <dt class="col-sm-4">Assigned Person</dt>
            <dd class="col-sm-8">{{ dispatch.assigned_person.username if dispatch.assigned_person else 'N/A' }}</dd>
            {% endif %}
            
            {% if dispatch.location_from_id or dispatch.location_to_id %}
            <dt class="col-sm-4">Locations</dt>
            <dd class="col-sm-8">
                {% if dispatch.location_from_id %}
                    <strong>From:</strong> {{ dispatch.location_from_id }}<br>
                {% endif %}
                {% if dispatch.location_to_id %}
                    <strong>To:</strong> {{ dispatch.location_to_id }}
                {% endif %}
            </dd>
            {% endif %}
            
            <dt class="col-sm-4">Created</dt>
            <dd class="col-sm-8">
                <small class="text-muted">
                    {{ dispatch.created_at.strftime('%Y-%m-%d %H:%M') if dispatch.created_at else 'N/A' }}
                </small>
            </dd>
        </dl>
    </div>
</div>

