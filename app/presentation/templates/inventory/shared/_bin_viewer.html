{# Bin Viewer Partial - Based on storeroom/build.html style #}
{#
Parameters:
  - selected_location: Location object with bin_layout_svg
  - bins_list: List of bin dicts/objects with id, bin_tag, display_name
  - selected_bin_id: Currently selected bin ID for highlighting
  - mode: 'htmx' | 'js' | 'readonly'
  - card_url_builder: Callable or variable to build bin card URLs (or None)
  - sidebar_heading: Heading text for sidebar (default: "BINS")
  - extra_sidebar_content: Optional content to add after bin list (forms, skip button)
  - card_footer_content: Optional content to add in card-footer (upload forms, etc.)
  - card_col_class: Bootstrap column class for cards (default: 'col-6')
#}
{% set sidebar_heading = sidebar_heading|default('BINS') %}
{% set card_col_class = card_col_class|default('col-6') %}

{% if selected_location %}
<div class="card mb-4">
    <div class="card-header bg-secondary text-white">
        <h3 class="mb-0"><em>Bin Viewer {{ selected_location.display_name or selected_location.location }}</em></h3>
    </div>
    <div class="card-body">
        <div class="row">
            <!-- Main Content Area (Left 2/3) -->
            <div class="col-lg-8">
                <div class="bin-layout-image svg-display-area">
                    {% if selected_location.bin_layout_svg %}
                        {{ selected_location.bin_layout_svg|safe }}
                    {% else %}
                        <div class="text-muted text-center py-5">
                            <i class="bi bi-file-image mb-3" style="font-size: 3rem;"></i>
                            <p><em>No bin layout SVG uploaded yet</em></p>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Sidebar (Right 1/3) -->
            <div class="col-lg-4">
                <h4 class="mb-3"><em>{{ sidebar_heading }}</em></h4>
                <div class="locations-sidebar">
                        {% if (selected_location and selected_location.bins) or bins_list %}
                            <div class="row g-2">
                                {% if selected_location and selected_location.bins %}
                                    {# Use location.bins directly if available (storeroom/build style) #}
                                    {% for bin_item in selected_location.bins|sort(attribute='bin_tag') %}
                                        {% set bin = bin_item %}
                                        {% if mode == 'htmx' and card_url_builder %}
                                            {# HTMX mode - use URL builder macro to create link #}
                                            {% set bin_url = card_url_builder(bin.id) %}
                                            {% include 'inventory/shared/_bin_card.html' %}
                                        {% elif mode == 'js' %}
                                            {# JavaScript mode - use onclick handler #}
                                            {% set bin_url = none %}
                                            {% set bin_onclick = 'binSelected(' ~ bin.id ~ ')' %}
                                            {% include 'inventory/shared/_bin_card.html' %}
                                        {% else %}
                                            {# Readonly mode - no link #}
                                            {% set bin_url = none %}
                                            {% include 'inventory/shared/_bin_card.html' %}
                                        {% endif %}
                                    {% endfor %}
                                {% elif bins_list %}
                                    {# Use bins_list (move_inventory_gui style) #}
                                    {% for bin_item in bins_list %}
                                        {% set bin = bin_item %}
                                        {% if mode == 'htmx' and card_url_builder %}
                                            {# HTMX mode - use URL builder macro to create link #}
                                            {% set bin_url = card_url_builder(bin.id) %}
                                            {% include 'inventory/shared/_bin_card.html' %}
                                        {% elif mode == 'js' %}
                                            {# JavaScript mode - use onclick handler #}
                                            {% set bin_url = none %}
                                            {% set bin_onclick = 'binSelected(' ~ bin.id ~ ')' %}
                                            {% include 'inventory/shared/_bin_card.html' %}
                                        {% else %}
                                            {# Readonly mode - no link #}
                                            {% set bin_url = none %}
                                            {% include 'inventory/shared/_bin_card.html' %}
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            </div>
                    {% else %}
                        <div class="text-center text-muted py-5">
                            <i class="bi bi-inbox" style="font-size: 3rem;"></i>
                            <p class="mt-3"><em>No bins found</em></p>
                        </div>
                    {% endif %}
                    
                    {# Extra sidebar content (forms, skip button, etc.) #}
                    {% if extra_sidebar_content %}
                        {{ extra_sidebar_content|safe }}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <div class="card-footer">
        {{ card_footer_content|default('')|safe }}
    </div>
</div>
{% endif %}

