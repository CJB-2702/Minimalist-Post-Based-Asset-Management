{# Location Viewer Partial - Based on storeroom/view.html style #}
{# 
Expects these variables from parent scope:
  - svg_content: SVG content to display (or _location_viewer_svg_content)
  - locations: List of location objects (or _location_viewer_locations)
  - selected_location_id: Currently selected location ID (or _location_viewer_selected_location_id)
  - mode: 'htmx' | 'anchor' | 'js' | 'readonly' (or _location_viewer_mode, default: 'readonly')
  - card_url_builder: Callable to build card URLs (for htmx mode)
  - sidebar_heading: Heading text (or _location_viewer_sidebar_heading, default: "locations")
  - extra_sidebar_content: Optional content to add after location list
  - card_col_class: Bootstrap column class (default: 'col-6')
  - svg_area_id: Optional ID for SVG display area (for JavaScript targeting)
#}
{% set svg_content = svg_content|default(_location_viewer_svg_content|default('')) %}
{% set svg_area_id = svg_area_id|default(_location_viewer_svg_area_id|default('')) %}
{% set locations = locations|default(_location_viewer_locations|default([])) %}
{% set selected_location_id = selected_location_id|default(_location_viewer_selected_location_id|default(none)) %}
{% set mode = mode|default(_location_viewer_mode|default('readonly')) %}
{% set sidebar_heading = sidebar_heading|default(_location_viewer_sidebar_heading|default('locations')) %}
{% set card_col_class = card_col_class|default('col-6') %}

<div class="card mb-4">
    <div class="card-header bg-secondary text-white">
        <h3 class="mb-0"><em>location Viewer</em></h3>
    </div>
    <div class="card-body">
        <div class="row">
            <!-- Main Content Area (Left 2/3) -->
            <div class="col-lg-8">
                <div class="svg-display-area"{% if svg_area_id %} id="{{ svg_area_id }}"{% endif %}>
                    {% if svg_content %}
                        {% if mode == 'js' %}
                            <div>{{ svg_content|safe }}</div>
                        {% else %}
                            {{ svg_content|safe }}
                        {% endif %}
                    {% else %}
                        <div class="text-muted text-center py-5">
                            <i class="bi bi-image mb-3" style="font-size: 3rem;"></i>
                            <p><em>No layout SVG uploaded yet</em></p>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Sidebar (Right 1/3) -->
            <div class="col-lg-4">
                <h4 class="mb-3"><em>{{ sidebar_heading }}</em></h4>
                <div class="locations-sidebar">
                    {% if locations %}
                        <div class="row g-2">
                            {% for location in locations %}
                                {% if mode == 'htmx' and card_url_builder %}
                                    {# HTMX mode - use URL builder macro to create link #}
                                    {% if card_url_builder %}
                                        {% set location_url = card_url_builder(location.id) %}
                                    {% else %}
                                        {% set location_url = None %}
                                    {% endif %}
                                    {% include 'inventory/shared/_location_card.html' %}
                                {% elif mode == 'anchor' %}
                                    {# Anchor mode - create anchor link #}
                                    {% set location_url = '#inventorylocation' ~ location.location %}
                                    {% include 'inventory/shared/_location_card.html' %}
                                {% elif mode == 'js' %}
                                    {# JavaScript mode - use onclick handler #}
                                    {% set location_url = None %}
                                    {% set location_onclick = 'locationSelected(' ~ location.id ~ ')' %}
                                    {% include 'inventory/shared/_location_card.html' %}
                                {% else %}
                                    {# Readonly mode - no link #}
                                    {% set location_url = None %}
                                    {% include 'inventory/shared/_location_card.html' %}
                                {% endif %}
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center text-muted py-5">
                            <i class="bi bi-inbox" style="font-size: 3rem;"></i>
                            <p class="mt-3"><em>No locations found</em></p>
                        </div>
                    {% endif %}
                    
                    {# Extra sidebar content (forms, buttons, etc.) #}
                    {% if extra_sidebar_content %}
                        {{ extra_sidebar_content|safe }}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <div class="card-footer">
        {{ card_footer_content|default('')|safe }}
    </div>
</div>

