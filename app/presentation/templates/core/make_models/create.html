{% extends "base.html" %}

{% block title %}Create Make/Model - Asset Management System{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>Create Make/Model</h1>
            <a href="{{ url_for('make_models.list') }}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> Back to Make/Models
            </a>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Make/Model Information</h5>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="make" class="form-label">Make <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="make" name="make" 
                                       value="{{ request.form.get('make', '') }}" required>
                                <div class="form-text">Manufacturer name (e.g., Toyota, Ford).</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="model" class="form-label">Model <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="model" name="model" 
                                       value="{{ request.form.get('model', '') }}" required>
                                <div class="form-text">Model name (e.g., Corolla, F-150).</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="year" class="form-label">Year</label>
                                <input type="number" class="form-control" id="year" name="year" 
                                       value="{{ request.form.get('year', '') }}" min="1900" max="2100">
                                <div class="form-text">Model year (optional).</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="revision" class="form-label">Revision</label>
                                <input type="text" class="form-control" id="revision" name="revision" 
                                       value="{{ request.form.get('revision', '') }}">
                                <div class="form-text">Revision or variant (e.g., LE, XSE).</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="asset_type_id" class="form-label">Asset Type</label>
                        <select class="form-select" id="asset_type_id" name="asset_type_id">
                            <option value="">Select Asset Type</option>
                            {% for asset_type in asset_types %}
                            <option value="{{ asset_type.id }}" 
                                    {% if request.form.get('asset_type_id')|int == asset_type.id %}selected{% endif %}>
                                {{ asset_type.name }}
                                {% if asset_type.category %}
                                    ({{ asset_type.category }})
                                {% endif %}
                            </option>
                            {% endfor %}
                        </select>
                        <div class="form-text">Category this make/model belongs to.</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" id="description" name="description" rows="3">{{ request.form.get('description', '') }}</textarea>
                        <div class="form-text">Brief description of the make/model and its characteristics.</div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="is_active" name="is_active" 
                                   {% if request.form.get('is_active', 'on') == 'on' %}checked{% endif %}>
                            <label class="form-check-label" for="is_active">
                                Active Make/Model
                            </label>
                        </div>
                        <div class="form-text">Inactive make/models cannot be assigned to new assets.</div>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('make_models.list') }}" class="btn btn-outline-secondary">
                            <i class="bi bi-x-circle"></i> Cancel
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i> Create Make/Model
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <!-- Detail Template Configuration Section -->
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                    <i class="bi bi-gear"></i>
                    Detail Table Auto-Create Configuration
                </h5>
            </div>
            <div class="card-body">
                <p class="text-muted small">
                    Configure which detail tables should be added to the model information for the selected asset type.
                    These detail tables will be automatically created for ALL FUTURE assets of this asset type.
                </p>
                
                <div id="config_button_container" style="display: none;" class="mt-3">
                    <a href="#" id="configure_model_detail_template_link" class="btn btn-sm btn-primary w-100" target="_blank">
                        <i class="bi bi-gear"></i> Configure Model Detail Templates
                    </a>
                </div>
                
                <div id="no_asset_type_message" class="text-muted small mt-3">
                    <em>Select an Asset Type above to configure templates</em>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const assetTypeSelect = document.getElementById('asset_type_id');
    const configButtonContainer = document.getElementById('config_button_container');
    const configureModelDetailTemplateLink = document.getElementById('configure_model_detail_template_link');
    const noAssetTypeMessage = document.getElementById('no_asset_type_message');
    
    // Asset type data from template
    const assetTypes = {
        {% for asset_type in asset_types %}
        {{ asset_type.id }}: {
            id: {{ asset_type.id }},
            name: "{{ asset_type.name }}"
        }{% if not loop.last %},{% endif %}
        {% endfor %}
    };
    
    assetTypeSelect.addEventListener('change', function() {
        const assetTypeId = this.value;
        
        if (assetTypeId && assetTypes[assetTypeId]) {
            // Show configuration button and hide message
            configButtonContainer.style.display = 'block';
            noAssetTypeMessage.style.display = 'none';
            
            // Update link to configure model detail templates for this asset type
            configureModelDetailTemplateLink.href = '{{ url_for("assets.detail_template_config.configure_model_detail_template", asset_type_id=0) }}'.replace('0', assetTypeId) + '?redirect_to=create_make_model';
        } else {
            // Hide configuration button and show message
            configButtonContainer.style.display = 'none';
            noAssetTypeMessage.style.display = 'block';
        }
    });
    
    // Trigger change on page load if asset type is already selected
    if (assetTypeSelect.value) {
        assetTypeSelect.dispatchEvent(new Event('change'));
    }
});
</script>
{% endblock %} 